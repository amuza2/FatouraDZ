<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FatouraDZ.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
             x:Class="FatouraDZ.Views.AccueilView"
             x:DataType="vm:AccueilViewModel">

    <Design.DataContext>
        <vm:AccueilViewModel/>
    </Design.DataContext>

    <ScrollViewer>
        <StackPanel Margin="40" Spacing="24">
            
            <!-- En-tête -->
            <StackPanel Spacing="8">
                <TextBlock Text="Tableau de bord" 
                           FontSize="28" FontWeight="Bold" 
                           Foreground="{StaticResource TextPrimaryBrush}"/>
                <TextBlock Text="{Binding NomEntrepreneur, StringFormat='Bienvenue, {0}'}" 
                           FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
            </StackPanel>

            <!-- Cartes statistiques -->
            <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto" ColumnSpacing="20">
                <!-- Carte 1 - Total factures -->
                <Border Grid.Column="0" 
                        Background="{StaticResource CardBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="24">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Total factures" 
                                   FontSize="13"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding NombreFactures}" 
                                   FontSize="32" FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock Text="{Binding NombreFacturesMois, StringFormat='+{0} ce mois'}" 
                                   FontSize="12"
                                   Foreground="{StaticResource SuccessBrush}"/>
                    </StackPanel>
                </Border>

                <!-- Carte 2 - Chiffre d'affaires -->
                <Border Grid.Column="1" 
                        Background="{StaticResource CardBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="24">
                    <StackPanel Spacing="12">
                        <TextBlock Text="Chiffre d'affaires" 
                                   FontSize="13"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding ChiffreAffairesTotal, StringFormat={}{0:N0} DA}" 
                                   FontSize="32" FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <TextBlock Text="Total" 
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Border>

                <!-- Carte 3 - CA ce mois -->
                <Border Grid.Column="2" 
                        Background="{StaticResource CardBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="24">
                    <StackPanel Spacing="12">
                        <TextBlock Text="CA ce mois" 
                                   FontSize="13"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding ChiffreAffairesMois, StringFormat={}{0:N0} DA}" 
                                   FontSize="32" FontWeight="Bold"
                                   Foreground="{StaticResource WarningBrush}"/>
                        <TextBlock Text="En cours" 
                                   FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Actions rapides -->
            <Border Background="{StaticResource CardBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24">
                <StackPanel Spacing="16">
                    <TextBlock Text="Actions rapides" 
                               FontSize="18" FontWeight="SemiBold"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Classes="primary"
                                Command="{Binding NouvelleFactureCommand}"
                                Content="Nouvelle facture"
                                Padding="16,12"/>
                        
                        <Button Command="{Binding VoirHistoriqueCommand}"
                                Content="Voir l'historique"
                                Padding="16,12"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Dernières factures -->
            <Border Background="{StaticResource CardBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="24">
                <StackPanel Spacing="16">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Dernières factures" 
                                   FontSize="18" FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <Button Grid.Column="1" 
                                Content="Voir tout →"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="{StaticResource PrimaryBrush}"
                                Command="{Binding VoirHistoriqueCommand}"
                                Padding="8,4"/>
                    </Grid>
                    
                    <!-- Message si aucune facture -->
                    <TextBlock Text="Aucune facture créée pour le moment."
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               FontStyle="Italic"
                               IsVisible="{Binding !DernieresFactures.Count}"/>

                    <!-- Liste des dernières factures -->
                    <ItemsControl ItemsSource="{Binding DernieresFactures}"
                                  IsVisible="{Binding DernieresFactures.Count}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="0,12" 
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="0,0,0,1">
                                    <Grid ColumnDefinitions="140,*,120,100">
                                        <StackPanel Grid.Column="0" Spacing="2">
                                            <TextBlock Text="{Binding NumeroFacture}" 
                                                       FontFamily="Consolas"
                                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock Text="{Binding DateFacture, StringFormat={}{0:dd/MM/yyyy}}" 
                                                       FontSize="12" 
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>
                                        
                                        <TextBlock Grid.Column="1" Text="{Binding ClientNom}" 
                                                   VerticalAlignment="Center" 
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        
                                        <TextBlock Grid.Column="2" 
                                                   Text="{Binding MontantTotal, StringFormat={}{0:N2} DA}" 
                                                   FontWeight="Medium" 
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   VerticalAlignment="Center"/>
                                        
                                        <Border Grid.Column="3" 
                                                Background="{Binding Statut, Converter={x:Static vm:StatutToColorConverter.Instance}}"
                                                CornerRadius="12" Padding="8,4"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Statut}" 
                                                       FontSize="11" FontWeight="Medium"
                                                       Foreground="White"/>
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
