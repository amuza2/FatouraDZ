<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:FatouraDZ.ViewModels"
             xmlns:models="using:FatouraDZ.Models"
             x:Class="FatouraDZ.Views.ClientListView"
             x:DataType="vm:ClientListViewModel">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Border Grid.Row="0" Background="#F8FAFC" Padding="30,20" BorderBrush="#E2E8F0" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="*,Auto,Auto">
                <StackPanel Grid.Column="0">
                    <TextBlock Text="ðŸ‘¥ Clients" FontSize="28" FontWeight="Bold" Foreground="#1E293B"/>
                    <TextBlock Text="GÃ©rez vos clients pour faciliter la crÃ©ation de factures" 
                               Foreground="#64748B" FontSize="14" Margin="0,5,0,0"/>
                </StackPanel>
                <TextBox Grid.Column="1" Text="{Binding Recherche}" 
                         Watermark="ðŸ” Rechercher..." Width="250" Margin="0,0,15,0"
                         VerticalAlignment="Center"/>
                <Button Grid.Column="2" Content="+ Nouveau client" 
                        Classes="primary"
                        Command="{Binding NouveauClientCommand}"
                        Padding="20,12"
                        FontSize="14"/>
            </Grid>
        </Border>

        <!-- Content -->
        <Grid Grid.Row="1">
            <!-- Client List -->
            <ScrollViewer Padding="30,20">
                <ScrollViewer.IsVisible>
                    <MultiBinding Converter="{x:Static BoolConverters.And}">
                        <Binding Path="!AfficherFormulaire"/>
                        <Binding Path="!AfficherDetails"/>
                    </MultiBinding>
                </ScrollViewer.IsVisible>
                <StackPanel Spacing="15" Margin="0,0,0,100">
                    <!-- Error message -->
                    <Border Background="#FEE2E2" CornerRadius="8" Padding="15"
                            IsVisible="{Binding MessageErreur, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="{Binding MessageErreur}" Foreground="#DC2626" TextWrapping="Wrap"/>
                    </Border>

                    <!-- Loading indicator -->
                    <Border Background="#F0F9FF" CornerRadius="8" Padding="30"
                            IsVisible="{Binding EstChargement}"
                            HorizontalAlignment="Center">
                        <TextBlock Text="Chargement..." Foreground="#0369A1" FontSize="16"/>
                    </Border>

                    <!-- Empty state -->
                    <Border Background="#F8FAFC" CornerRadius="12" Padding="60,40"
                            IsVisible="{Binding !Clients.Count}"
                            HorizontalAlignment="Center">
                        <StackPanel HorizontalAlignment="Center" Spacing="15">
                            <TextBlock Text="ðŸ‘¥" FontSize="48" HorizontalAlignment="Center"/>
                            <TextBlock Text="Aucun client" FontSize="20" FontWeight="SemiBold" 
                                       Foreground="#64748B" HorizontalAlignment="Center"/>
                            <TextBlock Text="Ajoutez vos clients pour les retrouver facilement lors de la crÃ©ation de factures"
                                       Foreground="#94A3B8" TextAlignment="Center" MaxWidth="350"/>
                            <Button Content="Ajouter un client" 
                                    Classes="primary"
                                    Command="{Binding NouveauClientCommand}"
                                    HorizontalAlignment="Center"
                                    Margin="0,10,0,0"
                                    Padding="25,12"/>
                        </StackPanel>
                    </Border>

                    <!-- Client list -->
                    <ItemsControl ItemsSource="{Binding Clients}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:Client">
                                <Border Background="White" CornerRadius="12" Padding="20" Margin="0,0,0,10"
                                        BorderBrush="#E2E8F0" BorderThickness="1">
                                    <Grid ColumnDefinitions="Auto,*,Auto">
                                        <!-- Icon -->
                                        <Border Grid.Column="0" Background="#EFF6FF" CornerRadius="10" 
                                                Width="50" Height="50" Margin="0,0,15,0">
                                            <TextBlock Text="ðŸ‘¤" FontSize="24" 
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        
                                        <!-- Client info -->
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                            <TextBlock Text="{Binding Nom}" FontSize="16" FontWeight="SemiBold" Foreground="#1E293B"/>
                                            <TextBlock Foreground="#64748B" FontSize="13">
                                                <Run Text="ðŸ“ "/><Run Text="{Binding Adresse, Mode=OneWay}"/>
                                            </TextBlock>
                                            <StackPanel Orientation="Horizontal" Spacing="15">
                                                <TextBlock Foreground="#94A3B8" FontSize="12">
                                                    <Run Text="ðŸ“ž "/><Run Text="{Binding Telephone, Mode=OneWay}"/>
                                                </TextBlock>
                                                <TextBlock Foreground="#94A3B8" FontSize="12"
                                                           IsVisible="{Binding Email, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                                    <Run Text="âœ‰ï¸ "/><Run Text="{Binding Email, Mode=OneWay}"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Actions -->
                                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                            <Button Content="ðŸ‘ï¸ Voir"
                                                    Command="{Binding $parent[ItemsControl].DataContext.VoirDetailsCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="12,8"
                                                    Background="#EFF6FF"/>
                                            <Button Content="âœï¸ Modifier"
                                                    Command="{Binding $parent[ItemsControl].DataContext.ModifierClientCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="12,8" Foreground="White"/>
                                            <Button Content="ðŸ—‘ï¸"
                                                    Background="#FEE2E2"
                                                    Command="{Binding $parent[ItemsControl].DataContext.SupprimerClientCommand}"
                                                    CommandParameter="{Binding}"
                                                    Padding="10,8"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </ScrollViewer>

            <!-- Client Detail View -->
            <ScrollViewer Padding="30,20" IsVisible="{Binding AfficherDetails}" HorizontalScrollBarVisibility="Disabled">
                <Border Background="White" CornerRadius="12" Padding="30">
                    <StackPanel Spacing="20">
                        <!-- Header -->
                        <Grid ColumnDefinitions="*,Auto">
                            <StackPanel Spacing="4">
                                <TextBlock Text="{Binding ClientDetail.Nom}" FontSize="24" FontWeight="Bold" Foreground="#1E293B"/>
                                <TextBlock Text="{Binding ClientDetail.TypeClient}" Foreground="#64748B" FontSize="13"/>
                            </StackPanel>
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Top">
                                <Button Content="âœï¸ Modifier" 
                                        Command="{Binding ModifierClientCommand}"
                                        CommandParameter="{Binding ClientDetail}"
                                        Padding="15,10" Foreground="White"/>
                                <Button Content="â† Retour" 
                                        Command="{Binding FermerDetailsCommand}"
                                        Padding="15,10"
                                        Background="#E2E8F0"/>
                            </StackPanel>
                        </Grid>

                        <Separator Background="#E2E8F0"/>

                        <!-- Informations gÃ©nÃ©rales -->
                        <TextBlock Text="Informations gÃ©nÃ©rales" FontSize="16" FontWeight="SemiBold" Foreground="#2563EB"/>
                        <Grid ColumnDefinitions="*,20,*">
                            <StackPanel Grid.Column="0" Spacing="8">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Nom / Raison sociale" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.Nom}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Adresse" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.Adresse}" FontSize="14" Foreground="#1E293B" TextWrapping="Wrap"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.Email, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Email" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.Email}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="8">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="TÃ©lÃ©phone" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.Telephone}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.Fax, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Fax" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.Fax}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.Activite, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="ActivitÃ©" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.Activite}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <Separator Background="#E2E8F0"/>

                        <!-- Informations fiscales -->
                        <TextBlock Text="Informations fiscales" FontSize="16" FontWeight="SemiBold" Foreground="#2563EB"/>
                        <Grid ColumnDefinitions="*,20,*">
                            <StackPanel Grid.Column="0" Spacing="8">
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.RC, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Registre de commerce (RC)" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.RC}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.NumeroImmatriculation, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="NÂ° Immatriculation" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.NumeroImmatriculation}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.NIF, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="NIF" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.NIF}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.CapitalSocial, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Capital social" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.CapitalSocial}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="8">
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.NIS, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="NIS" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.NIS}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                                <StackPanel Spacing="2" IsVisible="{Binding ClientDetail.AI, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                    <TextBlock Text="Article d'imposition (AI)" FontWeight="Medium" Foreground="#64748B" FontSize="12"/>
                                    <TextBlock Text="{Binding ClientDetail.AI}" FontSize="14" Foreground="#1E293B"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <!-- Metadata -->
                        <Separator Background="#E2E8F0"/>
                        <StackPanel Orientation="Horizontal" Spacing="20">
                            <TextBlock Foreground="#94A3B8" FontSize="12">
                                <Run Text="CrÃ©Ã© le: "/><Run Text="{Binding ClientDetail.DateCreation, StringFormat={}{0:dd/MM/yyyy}, Mode=OneWay}"/>
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </ScrollViewer>

            <!-- Client Form -->
            <ScrollViewer Padding="30,20" IsVisible="{Binding AfficherFormulaire}" HorizontalScrollBarVisibility="Disabled">
                <Border Background="White" CornerRadius="12" Padding="30">
                    <StackPanel Spacing="20">
                        <StackPanel.Styles>
                            <Style Selector="TextBox">
                                <Setter Property="HorizontalAlignment" Value="Stretch"/>
                                <Setter Property="MinWidth" Value="0"/>
                            </Style>
                        </StackPanel.Styles>
                        <TextBlock Text="{Binding TitreFormulaire}" FontSize="24" FontWeight="Bold" Foreground="#1E293B"/>
                        
                        <!-- Error message -->
                        <Border Background="#FEE2E2" CornerRadius="8" Padding="15"
                                IsVisible="{Binding MessageErreur, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <TextBlock Text="{Binding MessageErreur}" Foreground="#DC2626" TextWrapping="Wrap"/>
                        </Border>

                        <!-- Type de client -->
                        <StackPanel Spacing="4">
                            <TextBlock Text="Type de client" FontWeight="Medium"/>
                            <ComboBox SelectedIndex="{Binding TypeClientIndex}" HorizontalAlignment="Stretch">
                                <ComboBoxItem Content="Forfait"/>
                                <ComboBoxItem Content="SociÃ©tÃ© (RÃ©el)"/>
                                <ComboBoxItem Content="Auto-Entrepreneur"/>
                            </ComboBox>
                        </StackPanel>

                        <!-- Informations gÃ©nÃ©rales -->
                        <TextBlock Text="Informations gÃ©nÃ©rales" FontSize="16" FontWeight="SemiBold" 
                                   Foreground="#2563EB" Margin="0,10,0,0"/>
                        
                        <Grid ColumnDefinitions="*,20,*">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="Nom / Raison sociale *" FontWeight="Medium"/>
                                <TextBox Text="{Binding Nom}" Watermark="Nom du client"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <TextBlock Text="TÃ©lÃ©phone *" FontWeight="Medium"/>
                                <TextBox Text="{Binding Telephone}" Watermark="0XX XX XX XX"/>
                            </StackPanel>
                        </Grid>

                        <StackPanel Spacing="4">
                            <TextBlock Text="Adresse *" FontWeight="Medium"/>
                            <TextBox Text="{Binding Adresse}" Watermark="Adresse complÃ¨te"/>
                        </StackPanel>

                        <Grid ColumnDefinitions="*,20,*">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="Email" FontWeight="Medium"/>
                                <TextBox Text="{Binding Email}" Watermark="email@exemple.com"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <TextBlock Text="Fax" FontWeight="Medium"/>
                                <TextBox Text="{Binding Fax}" Watermark="0XX XX XX XX"/>
                            </StackPanel>
                        </Grid>

                        <!-- Informations fiscales -->
                        <TextBlock Text="Informations fiscales" FontSize="16" FontWeight="SemiBold" 
                                   Foreground="#2563EB" Margin="0,10,0,0"/>

                        <StackPanel Spacing="4" IsVisible="{Binding AfficherCapitalSocial}">
                            <TextBlock Text="Capital social" FontWeight="Medium"/>
                            <TextBox Text="{Binding CapitalSocial}" Watermark="Ex: 1 000 000 DA"/>
                        </StackPanel>

                        <Grid ColumnDefinitions="*,20,*">
                            <StackPanel Grid.Column="0" Spacing="4" IsVisible="{Binding AfficherRC}">
                                <TextBlock Text="Registre de commerce (RC)" FontWeight="Medium"/>
                                <TextBox Text="{Binding Rc}" Watermark="XX/XX-XXXXXXX"/>
                            </StackPanel>
                            <StackPanel Grid.Column="0" Spacing="4" IsVisible="{Binding AfficherNumeroImmatriculation}">
                                <TextBlock Text="NÂ° Immatriculation" FontWeight="Medium"/>
                                <TextBox Text="{Binding NumeroImmatriculation}" Watermark="NumÃ©ro d'immatriculation"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <TextBlock Text="NIF" FontWeight="Medium"/>
                                <TextBox Text="{Binding Nif}" Watermark="NumÃ©ro d'identification fiscale"/>
                            </StackPanel>
                        </Grid>

                        <Grid ColumnDefinitions="*,20,*">
                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="NIS" FontWeight="Medium"/>
                                <TextBox Text="{Binding Nis}" Watermark="NumÃ©ro d'identification statistique"/>
                            </StackPanel>
                            <StackPanel Grid.Column="2" Spacing="4">
                                <TextBlock Text="Article d'imposition (AI)" FontWeight="Medium"/>
                                <TextBox Text="{Binding Ai}" Watermark="Article d'imposition"/>
                            </StackPanel>
                        </Grid>

                        <StackPanel Spacing="4">
                            <TextBlock Text="ActivitÃ©" FontWeight="Medium"/>
                            <TextBox Text="{Binding Activite}" Watermark="Secteur d'activitÃ©"/>
                        </StackPanel>

                        <!-- Buttons -->
                        <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,20,0,30">
                            <Button Grid.Column="1" Content="Annuler" 
                                    Command="{Binding AnnulerFormulaireCommand}"
                                    Padding="20,12" Margin="0,0,10,0"/>
                            <Button Grid.Column="2" Content="ðŸ’¾ Enregistrer" 
                                    Classes="primary"
                                    Command="{Binding EnregistrerClientCommand}"
                                    Padding="20,12"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
